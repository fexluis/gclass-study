<!DOCTYPE html>
<html>
  <head>
    <script src="./index.js"></script>
    <title>StudyFinder</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./style.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
  </head>
  <body onload="openModal()">
    <center>
      <img src="./Logo.png" alt="StudyFinder Logo" height="150" width="150" style="margin-left: 10px">
    </center>

    
    <div id="myModal" class="modal">
      
      <!-- Modal content -->
      <div class="modal-content">
        <center>
          <img src="./gc.png" alt="Google Classroom" style="height: 100px; width: 100px;">
        </center>
        <p>Login to Google Classroom to access clasess.</p>
        <button onclick="authenticate().then(loadClient).then(execute).then(closeModal)" style="width: 100%;border-radius: 10px;">Login</button>
      </div>
    
    </div>

    <pre id="content" style="white-space: pre-wrap;"></pre>
    
    <div id="testModal" class="modal">
      
      <!-- Modal content -->
      <div class="modal-content">
        <form action="#" method="post" onSubmit="processForm(event)">
          <!-- add Test -->
          <span class="close">&times;</span>
          <h2>Enter Test Dates</h2>
          <div>Enter date: <br> <input type="text" name="my_date"/></div>
          <input type="radio" id="class1" value="class1"><label id="class1label" for="class1"></label> <br>
          <input type="radio" id="class2" value="class2"><label id="class2label" for="class2"></label> <br>
          <input type="radio" id="class3" value="class3"><label id="class3label" for="class3"></label> <br>
          <input type="radio" id="class4" value="class4"><label id="class4label" for="class4"></label> <br>
          <input type="radio" id="class5" value="class5"><label id="class5label" for="class5"></label> <br>
          <input type="radio" id="class6" value="class6"><label id="class6label" for="class6"></label> <br>
          <input type="radio" id="class7" value="class7"><label id="class7label" for="class7"></label> <br>
          <input type="radio" id="class8" value="class8"><label id="class8label" for="class8"></label> <br>
          <div>
            <button type="submit">Add Test</button>
          </div>
          </form>
      </div>
    
    </div>

    <!-- Collapsible Tables -->
    <h2>Calendar</h2>
    <button type="button" class="collapsible">
      <table id = "table1" style="width:100%">
        <tr>
          <th id="date"></th>
        </tr>
      </table>
    </button>
    <div class="content">
      <table style="width: 75%;">
        <tr>
          <th>Class</th>
          <th>Due Date</th>
          <th>Assignment Type</th>
        </tr>
                  <ul style="list-style-type: none;" id="worklist1">
                    <li><tr>
                      <td>class1</td>
                      <td>date</td>
                      <td>Test</td>
                      <td>
                        <button id="markdone" onclick="MarkAsDone()">Mark As Done</button>
                      </td>
                    </tr></li>
                  </ul>
      </table>
    </div>

    <hr>

    <button type="button" class="collapsible">
      <table id = "table2" style="width:100%">
        <tr>
          <th id="date1"></th>
        </tr>
      </table>
    </button>
    <div class="content">
      <table style="width: 75%;">
          <tr>
            <th>Class</th>
            <th>Due Date</th>
            <th>Assignment Type</th>
          </tr>
          <ul style="list-style-type: none;" id="worklist2">
            <li><tr>
              <td>class1</td>
              <td>date</td>
              <td>Test</td>
              <td>
                <button id="markdone" onclick="MarkAsDone()">Mark As Done</button>
              </td>
            </tr></li>
          </ul>
      </table>
    </div>

    <hr>

    <button type="button" class="collapsible">
      <table id = "table3" style="width:100%">
        <tr>
          <th id="date2"></th>
        </tr>
      </table>
    </button>
    <div class="content">
      <table style="width: 75%;">
          <tr>
            <th>Class</th>
            <th>Due Date</th>
            <th>Assignment Type</th>
          </tr>
          <ul style="list-style-type: none;" id="worklist3">
            <li><tr>
              <td>class1</td>
              <td>date</td>
              <td>Test</td>
              <td>
                <button id="markdone" onclick="MarkAsDone()">Mark As Done</button>
              </td>
            </tr></li>
          </ul>
      </table>
    </div>

    <hr>

    <button type="button" class="collapsible">
      <table id = "table4" style="width:100%">
        <tr>
          <th id="date3"></th>
        </tr>
      </table>
    </button>
    <div class="content">
      <table style="width: 75%;">
          <tr>
            <th>Class</th>
            <th>Due Date</th>
            <th>Assignment Type</th>
          </tr>
          <ul style="list-style-type: none;" id="worklist4">
            <li><tr>
              <td>class1</td>
              <td>date</td>
              <td>Test</td>
              <td>
                <button id="markdone" onclick="MarkAsDone()">Mark As Done</button>
              </td>
            </tr></li>
          </ul>
      </table>
    </div>

    <hr>

    <button type="button" class="collapsible">
      <table id = "table5" style="width:100%">
        <tr>
          <th id="date4"></th>
        </tr>
      </table>
    </button>
    <div class="content">
      <table style="width: 75%;">
          <tr>
            <th>Class</th>
            <th>Due Date</th>
            <th>Assignment Type</th>
          </tr>
          <ul style="list-style-type: none;" id="worklist5">
            <li><tr>
              <td>class1</td>
              <td>date</td>
              <td>Test</td>
              <td>
                <button id="markdone" onclick="MarkAsDone()">Mark As Done</button>
              </td>
            </tr></li>
          </ul>
      </table>
    </div>

    <hr>

    <button type="button" class="collapsible">
      <table id = "table6" style="width:100%">
        <tr>
          <th id="date5"></th>
        </tr>
      </table>
    </button>
    <div class="content">
      <table style="width: 75%;">
          <tr>
            <th>Class</th>
            <th>Due Date</th>
            <th>Assignment Type</th>
          </tr>
          <ul style="list-style-type: none;" id="worklist6">
            <li><tr>
              <td>class1</td>
              <td>date</td>
              <td>Test</td>
              <td>
                <button id="markdone" onclick="MarkAsDone()">Mark As Done</button>
              </td>
            </tr></li>
          </ul>
      </table>
    </div>

    <hr>

    <button type="button" class="collapsible">
      <table id = "table7" style="width:100%">
        <tr>
          <th id="date6"></th>
        </tr>
      </table>
    </button>
    <div class="content">
      <table style="width: 75%;">
          <tr>
            <th>Class</th>
            <th>Due Date</th>
            <th>Assignment Type</th>
          </tr>
          <ul style="list-style-type: none;" id="worklist7">
            <li><tr>
              <td>class1</td>
              <td>date</td>
              <td>Test</td>
              <td>
                <button id="markdone" onclick="MarkAsDone()">Mark As Done</button>
              </td>
            </tr></li>
          </ul>
      </table>
    </div>

    <hr>

    <button id="newTest" style="width:100%">Add Test</button>

    <script type="text/javascript">

        n = new Date();
        y = n.getFullYear();
        m = n.getMonth() + 1;
        d = n.getDate();
        d1 = n.getDate() + 1;
        d2 = n.getDate() + 2;
        d3 = n.getDate() + 3;
        d4 = n.getDate() + 4;
        d5 = n.getDate() + 5;
        d6 = n.getDate() + 6;
        d7 = n.getDate() + 7;
        d8 = n.getDate() + 8;
        d9 = n.getDate() + 9;
        d10 = n.getDate() + 10;

        document.getElementById("date").innerHTML = m + "/" + d + "/" + y;
        document.getElementById("date1").innerHTML = m + "/" + d1 + "/" + y;
        document.getElementById("date2").innerHTML = m + "/" + d2 + "/" + y;
        document.getElementById("date3").innerHTML = m + "/" + d3 + "/" + y;
        document.getElementById("date4").innerHTML = m + "/" + d4 + "/" + y;
        document.getElementById("date5").innerHTML = m + "/" + d5 + "/" + y;
        document.getElementById("date6").innerHTML = m + "/" + d6 + "/" + y;
        
        /*
        function addToTestList(String testDate, String classofTest, List){
          List.push([testDate.split("/")], [classofTest]);
          for (i = 1; i < List.length; i++):
        }
        */

        var coll = document.getElementsByClassName("collapsible");
        var i;

        for (i = 0; i < coll.length; i++) {
          coll[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.display === "block") {
              content.style.display = "none";
            } 
            else {
              content.style.display = "block";
            }
          });
        }

        function addTest(){
          console.log("add test")
        }

        // Client ID and API key from the Developer Console
        // Client ID and API key from the Developer Console
        var CLIENT_ID = '36403631458-78b24b82hp3gpihfem51jcdadilku1c8.apps.googleusercontent.com';
        var API_KEY = 'AIzaSyB2ynQ_Zy4KC3k2u_A_GV0qNi0TVD-oRP0';

        // Array of API discovery doc URLs for APIs used by the quickstart
        var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/classroom/v1/rest"];

        // Authorization scopes required by the API; multiple scopes can be
        // included, separated by spaces.
        var SCOPES = "https://www.googleapis.com/auth/classroom.courses.readonly https://www.googleapis.com/auth/classroom.courses https://www.googleapis.com/auth/classroom.coursework.me https://www.googleapis.com/auth/classroom.coursework.me.readonly https://www.googleapis.com/auth/classroom.coursework.students https://www.googleapis.com/auth/classroom.coursework.students.readonly https://www.googleapis.com/auth/classroom.coursework.students ";

        var authorizeButton = document.getElementById('authorize_button');
        var signoutButton = document.getElementById('signout_button');

        /**
         *  On load, called to load the auth2 library and API client library.
         */
        function handleClientLoad() {
          gapi.load('client:auth2', initClient);
        }

        /**
         *  Initializes the API client library and sets up sign-in state
         *  listeners.
         */
        function initClient() {
          gapi.client.init({
            apiKey: API_KEY,
            clientId: CLIENT_ID,
            discoveryDocs: DISCOVERY_DOCS,
            scope: SCOPES
          }).then(function () {
            // Listen for sign-in state changes.
            gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

            // Handle the initial sign-in state.
            updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            authorizeButton.onclick = handleAuthClick;
            signoutButton.onclick = handleSignoutClick;
          }, function(error) {
            appendPre(JSON.stringify(error, null, 2));
          });
        }

        /**
         *  Called when the signed in status changes, to update the UI
         *  appropriately. After a sign-in, the API is called.
         */
        function updateSigninStatus(isSignedIn) {
          if (isSignedIn) {
            authorizeButton.style.display = 'none';
            signoutButton.style.display = 'block';
            listCourses();
          } else {
            authorizeButton.style.display = 'block';
            signoutButton.style.display = 'none';
          }
        }

        /**
         *  Sign in the user upon button click.
         */
        function handleAuthClick(event) {
          gapi.auth2.getAuthInstance().signIn();
        }

        /**
         *  Sign out the user upon button click.
         */
        function handleSignoutClick(event) {
          gapi.auth2.getAuthInstance().signOut();
        }

        /**
         * Append a pre element to the body containing the given message
         * as its text node. Used to display the results of the API call.
         *
         * @param {string} message Text to be placed in pre element.
         */
        function appendPre(message) {
          var pre = document.getElementById('content');
          var textContent = document.createTextNode(message + '\n');
          pre.appendChild(textContent);
        }

        /**
         * Print the names of the first 10 courses the user has access to. If
         * no courses are found an appropriate message is printed.
         */
        function listCourses() {
          gapi.client.classroom.courses.list({
            pageSize: 10
          }).then(function(response) {
            var courses = response.result.courses;
            appendPre('Courses:');

            if (courses.length > 0) {
              for (i = 0; i < courses.length; i++) {
                var course = courses[i];
                appendPre(course.name)
              }
            } else {
              appendPre('No courses found.');
            }
          });
        }
        
      </script>

      <script async defer src="https://apis.google.com/js/api.js"
        onload="this.onload=function(){};handleClientLoad()"
        onreadystatechange="if (this.readyState === 'complete') this.onload()">
      </script>

    <script src="https://apis.google.com/js/api.js"></script>
<script src="https://apis.google.com/js/api.js"></script>
<script>

  /**
   * Sample JavaScript code for classroom.courses.list
   * See instructions for running APIs Explorer code samples locally:
   * https://developers.google.com/explorer-help/guides/code_samples#javascript
   */

  function authenticate() {
    return gapi.auth2.getAuthInstance()
        .signIn({scope: SCOPES})
        .then(function() { console.log("Sign-in successful"); },
              function(err) { console.error("Error signing in", err); });
  }
  function loadClient() {
    gapi.client.setApiKey("AIzaSyB2ynQ_Zy4KC3k2u_A_GV0qNi0TVD-oRP0");
    return gapi.client.load("36403631458-78b24b82hp3gpihfem51jcdadilku1c8.apps.googleusercontent.com")
        .then(function() { console.log("GAPI client loaded for API"); },
              function(err) { console.error("Error loading GAPI client for API", err); });
  }
  // Make sure the client is loaded and sign-in is complete before calling this method.
  function execute() {
    return gapi.client.classroom.courses.list({})
        .then(function(response) {
                // Handle the results here (response.result has the parsed body).
                console.log("Response", response);
                courses = response;
                getCourses();
              },
              function(err) { console.error("Execute error", err); });
  }
  gapi.load("client:auth2", function() {
    gapi.auth2.init({client_id: "36403631458-78b24b82hp3gpihfem51jcdadilku1c8.apps.googleusercontent.com"});
  });

  coursesArray = new Array();

  function getCourses() {
    console.log("returned Courses");
    var courseList = new Array();
    coursesArray = new Array();
    for(i = 0; i < 8; i++) {
      courseList.push(courses.result.courses[i]);
      //x.innerHTML = courseList[i].name;
      getCourseWork(courseList[i].id, i, courseList[i].name);
      coursesArray.push(courseList[i].name);
    }
    setCourses();
  }

  function getCourseList() {
    return coursesArray;
  }

  function setCourses() {
    for(i = 0; i < coursesArray.length; i++) {
      var x = document.getElementById("class"+(i+1)+"label");
      console.log(x);
      x.innerHTML = coursesArray[i];
    }
  }

  var work = new Array();
  function getCourseWork(id, i, course) {
    return gapi.client.classroom.courses.courseWork.list({
      "courseId": id
    })
        .then(function(response) {
                // Handle the results here (response.result has the parsed body).
                var x = response.result.courseWork;
                for(j = 0; j < x.length; j++) {
                  //console.log(x[j]);
                  var list = {name: course, title: x[j].title, link: x[j].alternateLink, type: x[j].workType};
                  if(list.type.localeCompare("ASSIGNMENT") == 0) {
                    work.push(list);
                  }
                }

                console.log(work.length);
                listCourseWork();
              },
              function(err) { console.error("Execute error", err); }
              );
  }

  function listCourseWork() {
    for(j = 1; j <= 7; j++) {
      for(i = 0; i < work.length; i++) {
        var table = document.getElementById("table"+j);
        var row = table.insertRow(0);
        var node = document.createElement("LI");
        var link = document.createElement("a");
        var linktext = document.createTextNode("Google Classroom Page");
        link.appendChild(linktext);
        link.href = work[i].link;
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        cell1.innerHTML = work[i].name;
        cell2.innerHTML = work[i].title;
        cell3.innerHTML = work[i].type;
        cell4.appendChild(link);
        node.append(row)
        document.getElementById("worklist"+j).appendChild(node);
      } 
    }
    
  }

  function divByDay(list){
    var div = list.length / 7;
    //console.log(div);
    for(var i = 0; i < div; i++){
      
    }
  }


var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementById("close");

// When the user clicks the button, open the modal 
function openModal() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
function closeModal() {
  modal.style.display = "none";
}

//test modal
// Get the modal
var modal2 = document.getElementById("testModal");

// Get the button that opens the modal
var btn2 = document.getElementById("newTest");

// Get the <span> element that closes the modal
var span2 = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal 
btn2.onclick = function() {
  modal2.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span2.onclick = function() {
  modal2.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal2) {
    modal2.style.display = "none";
  }
}






</script>
  </body>
</html>
